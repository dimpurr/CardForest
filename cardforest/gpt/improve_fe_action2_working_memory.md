# CardForest 前端改进计划 - 阶段2：认证与页面结构

## 检查清单

### 第一阶段：认证系统优化
- [ ] 1.1 保留双重认证系统，但优化前端体验
  - [ ] 1.1.1 保留后端独立认证系统用于API调试
  - [ ] 1.1.2 统一前端认证流程和组件
  - [ ] 1.1.3 改进JWT处理逻辑
- [ ] 1.2 统一登录页面
  - [ ] 1.2.1 优化`/auth/signin`页面
  - [ ] 1.2.2 移除或重定向`/login`页面
  - [ ] 1.2.3 统一登录UI组件

### 第二阶段：页面结构统一
- [ ] 2.1 统一布局组件
  - [ ] 2.1.1 确保所有页面使用`Layout`组件
  - [ ] 2.1.2 统一页面标题和导航结构
  - [ ] 2.1.3 改进响应式设计
- [ ] 2.2 统一组件库
  - [ ] 2.2.1 移除Chakra UI依赖
  - [ ] 2.2.2 确保所有页面使用一致的UI组件
  - [ ] 2.2.3 统一样式和主题

### 第三阶段：路由和导航优化
- [ ] 3.1 实现统一的路由保护
  - [ ] 3.1.1 创建`ProtectedRoute`组件
  - [ ] 3.1.2 统一认证检查和重定向逻辑
  - [ ] 3.1.3 改进加载状态显示
- [ ] 3.2 优化用户导航流程
  - [ ] 3.2.1 明确定义导航路径
  - [ ] 3.2.2 改进面包屑导航
  - [ ] 3.2.3 添加上下文相关的导航提示

## 详细计划

### 第一阶段：认证系统优化

#### 1.1 保留双重认证系统，但优化前端体验

**当前状况**：
- 前端使用NextAuth进行认证
- 后端使用直接OAuth认证
- 两种认证方式并存，但用户体验不一致
- JWT处理逻辑分散在多个地方

**改进方案**：
1. **保留后端独立认证系统**：
   - 保持后端API的独立认证能力
   - 确保`/install`等调试端点仍可通过后端认证访问
   - 维护后端认证的简单UI界面

2. **统一前端认证流程**：
   - 完全迁移到`AuthContext`和`useAuth`钩子
   - 确保所有组件使用统一的认证检查方法
   - 提供清晰的登录状态指示

3. **改进JWT处理逻辑**：
   - 集中JWT处理到`AuthService`
   - 保持从多个来源获取JWT的能力
   - 改进错误处理和日志记录

#### 1.2 统一登录页面

**当前状况**：
- 存在多个登录页面：`/auth/signin`和`/login`
- `/cards`页面也包含登录选项
- 使用不同的UI组件库

**改进方案**：
1. **优化`/auth/signin`页面**：
   - 改进UI设计，使其更加用户友好
   - 清晰区分前端和后端登录选项
   - 添加更好的错误处理和反馈

2. **处理`/login`页面**：
   - 将`/login`重定向到`/auth/signin`
   - 或者完全移除`/login`页面

3. **统一登录UI组件**：
   - 确保所有登录相关组件使用一致的样式
   - 改进登录按钮和表单的用户体验

### 第二阶段：页面结构统一

#### 2.1 统一布局组件

**当前状况**：
- 有些页面使用`Layout`组件
- 有些页面直接渲染内容
- 页面间的导航体验不一致

**改进方案**：
1. **确保所有页面使用`Layout`组件**：
   - 审查所有页面，确保使用统一的布局
   - 修复任何缺少布局的页面

2. **统一页面标题和导航结构**：
   - 实现一致的页面标题格式
   - 确保导航菜单在所有页面上一致

3. **改进响应式设计**：
   - 确保所有页面在移动设备上表现良好
   - 优化布局组件的响应式行为

#### 2.2 统一组件库

**当前状况**：
- 大部分页面使用自定义UI组件
- `/login`页面使用Chakra UI组件
- 样式不一致

**改进方案**：
1. **移除Chakra UI依赖**：
   - 将Chakra UI组件替换为自定义组件
   - 确保不引入新的UI库依赖

2. **确保所有页面使用一致的UI组件**：
   - 审查所有页面，确保使用统一的组件
   - 替换任何不一致的组件

3. **统一样式和主题**：
   - 确保所有组件遵循同一主题
   - 统一颜色、字体和间距

### 第三阶段：路由和导航优化

#### 3.1 实现统一的路由保护

**当前状况**：
- 多个页面包含类似的认证检查和重定向逻辑
- 认证状态检查不一致
- 加载状态显示不一致

**改进方案**：
1. **创建`ProtectedRoute`组件**：
   - 实现一个可重用的路由保护组件
   - 处理认证检查和重定向

2. **统一认证检查和重定向逻辑**：
   - 使用`ProtectedRoute`替换所有页面中的认证检查
   - 确保一致的重定向行为

3. **改进加载状态显示**：
   - 实现一致的加载指示器
   - 避免在认证检查期间出现闪烁

#### 3.2 优化用户导航流程

**当前状况**：
- 导航路径不明确
- 缺少面包屑导航
- 缺少上下文相关的导航提示

**改进方案**：
1. **明确定义导航路径**：
   - 首页 -> 登录 -> 卡片列表/模型列表
   - 卡片列表 -> 创建/编辑卡片
   - 模型列表 -> 创建/编辑模型

2. **改进面包屑导航**：
   - 添加面包屑组件
   - 显示当前位置和导航历史

3. **添加上下文相关的导航提示**：
   - 在适当的位置添加"返回"按钮
   - 提供相关页面的快捷链接

## 实施策略

### 优先级和顺序

1. 首先解决最紧急的问题：
   - 统一认证流程和组件
   - 统一登录页面

2. 然后改进用户体验：
   - 统一布局组件
   - 实现路由保护

3. 最后优化细节：
   - 统一组件库
   - 优化导航流程

### 渐进式实施

- 采用增量方法，避免大规模重写
- 先创建新组件，然后逐步替换现有组件
- 保持向后兼容，确保功能不中断

### 测试和验证

- 每个改进后进行测试
- 确保现有功能不受影响
- 验证两种认证方式仍然有效

## 预期成果

- 更一致、直观的用户界面
- 保留后端独立认证能力
- 改进的前端认证体验
- 更清晰的导航结构
- 更好的代码组织和可维护性
