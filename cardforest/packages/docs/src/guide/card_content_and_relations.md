# CardForest: 面向对象的卡片系统设计

## 设计哲学

CardForest 的核心是一个面向对象的卡片系统。每张卡片都是一个对象，继承自特定的模板类。这种设计让我们能够结合 Notion 的结构化数据管理和 Obsidian/Roam 的动态链接能力，创建一个既灵活又规范的知识管理系统。

### 模板继承体系

在 CardForest 中，所有卡片都继承自基础模板（Basic Template）。这个基础模板定义了卡片的核心属性：

- **系统字段**（不可删除）：
  - 创建时间（createdAt）
  - 更新时间（updatedAt）
  - 创建者（createdBy）

- **基础字段**（不可删除，可修改）：
  - 标题（title）：文本输入
  - 主体（body）：默认为文本输入，可根据需要改为其他类型（如图片、视频等）
  - 正文（content）：富文本区域，支持动态链接和嵌入

用户可以通过继承基础模板来创建自定义模板，添加额外的字段和行为，就像在 Django 中扩展模型一样。这种继承机制确保了所有卡片都具有基本的功能，同时保持了扩展的灵活性。

### 卡片的多层次内容

每个卡片包含三个主要部分，它们的组织遵循明确的优先级：

1. **Body（主体内容）**
   - 卡片的核心内容载体
   - 可以是文本、图片、视频等多种类型
   - 当存在时，作为卡片的主要展示内容

2. **Content（富文本正文）**
   - 支持 TipTap 编辑器的动态内容
   - 可以包含双向链接和动态嵌入
   - 当 body 存在时，作为补充说明

3. **Meta（元数据）**
   - 由模板定义的结构化数据字段
   - 支持多种数据类型和卡片引用
   - 用于组织和检索

## 动态链接系统

CardForest 的链接系统支持多种引用方式，所有引用都会在 ArangoDB 中建立关系：

1. **Meta 引用**
   - 通过元数据字段建立的结构化引用
   - 类似于关系数据库中的外键
   - 用于建立卡片间的强关系

2. **内联引用**
   - 在富文本中通过 `[[]]` 语法创建的链接
   - 支持悬浮预览和快速导航
   - 用于建立知识间的关联

3. **嵌入引用**
   - 在富文本中动态嵌入其他卡片的内容
   - 支持实时更新和交互
   - 用于知识的组合和展示

## 实现路线图

1. **基础模板系统**（第一阶段）
   - 实现基础模板（Basic Template）
   - 建立模板继承机制
   - 完成核心字段的处理

2. **元数据系统**（第二阶段）
   - 实现自定义字段的定义和验证
   - 支持多种数据类型
   - 添加字段引用功能

3. **富文本系统**（第三阶段）
   - 集成 TipTap 编辑器
   - 实现双向链接功能
   - 添加动态嵌入支持

## 技术实现要点

在 ArangoDB 中，我们需要特别注意以下几点：

1. **模板继承**
   - 使用模板引用记录继承关系
   - 在查询时合并字段定义
   - 确保基础字段的完整性

2. **关系存储**
   - 使用边集合存储不同类型的引用
   - 建立高效的图遍历查询
   - 维护双向链接的一致性

3. **数据验证**
   - 根据模板定义验证字段值
   - 确保必填字段的完整性
   - 处理字段类型转换

这种设计既保持了面向对象的严谨性，又提供了知识管理所需的灵活性。通过模板继承，我们可以轻松创建各种专门的卡片类型，同时保持系统的一致性和可维护性。
