scalar Date
scalar JSON

type User {
  _key: ID!
  _id: ID!
  username: String!
  createdAt: Date!
  updatedAt: Date!
}

type FieldDefinition {
  name: String!
  type: String!
  required: Boolean
  default: JSON
  config: JSON
}

type FieldGroup {
  _inherit_from: String!
  fields: [FieldDefinition!]!
}

type Template {
  _key: ID!
  _id: ID!
  _rev: String
  name: String!
  inherits_from: [String!]!
  fields: [FieldGroup!]!
  system: Boolean!
  createdAt: String!
  updatedAt: String
  createdBy: String
  __typename: String
}

type Card {
  _key: ID!
  _id: ID!
  templateId: ID!
  template: Template 
  title: String!
  content: String
  body: String
  meta: JSON!
  createdAt: Date!
  updatedAt: Date!
  createdBy: User!
}

type CardWithRelations {
  card: Card!
  children: [Card!]!
}

type AuthResponse {
  token: String!
  user: User!
}

input FieldDefinitionInput {
  name: String!
  type: String!
  required: Boolean
  default: JSON
  config: JSON
}

input FieldGroupInput {
  _inherit_from: String!
  fields: [FieldDefinitionInput!]!
}

input CreateTemplateInput {
  name: String!
  inherits_from: [String!]
  fields: [FieldGroupInput!]!
}

input UpdateTemplateInput {
  name: String
  inherits_from: [String!]
  fields: [FieldGroupInput!]
}

input CreateCardInput {
  templateId: ID!
  title: String!
  content: String
  body: String
  meta: JSON
}

input UpdateCardInput {
  title: String
  content: String
  body: String
  meta: JSON
}

type Query {
  # User related
  me: User

  # Template related
  template(id: ID!): Template
  templates: [Template!]!
  flattenedTemplate(id: ID!): Template

  # Card related
  card(id: ID!): Card
  cards: [Card!]!
  myCards: [Card!]!
  cardsWithRelations: [CardWithRelations!]!
}

type Mutation {
  # Auth related
  login(username: String!, password: String!): AuthResponse!
  register(username: String!, password: String!): User!

  # Template related
  createTemplate(input: CreateTemplateInput!): Template!
  updateTemplate(id: ID!, input: UpdateTemplateInput!): Template!
  deleteTemplate(id: ID!): Boolean!

  # Card related
  createCard(input: CreateCardInput!): Card!
  updateCard(id: ID!, input: UpdateCardInput!): Card!
  deleteCard(id: ID!): Boolean!
  createCardRelation(fromCardId: ID!, toCardId: ID!): Boolean!
}
